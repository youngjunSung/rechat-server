"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[746],{16048:(e,t,r)=>{r.d(t,{$n:()=>a,ry:()=>x,sB:()=>d,b0:()=>b,A_:()=>l});var n=r(96540),a=function(e){var t=e.className,r=e.text,a=e.onClick;return n.createElement("button",{type:"button",onClick:a,className:"flex items-center justify-center min-h-[54px] px-[10px] w-full bg-primary text-white rounded-[8px] text-[16px] font-bold ".concat(t)},r)},l=(0,n.memo)((function(e){var t=e.id,r=e.label,a=e.type,l=void 0===a?"text":a,o=e.className,c=e.onChange,i=e.value;return n.createElement("div",{className:"flex flex-col [&:not(&:last-child)]:mb-[20px] ".concat(o)},n.createElement("label",{htmlFor:t,className:"mb-[4px] text-primary text-[14px] font-[500]"},r),n.createElement("input",{type:l,id:t,className:"py-[10px] border-b-[2px] border-primary border-solid rounded-none focus:outline-none",onChange:c,value:i}))})),o=r(47767),c=r(31173),i=r(93365),u=r.n(i),s=r(35972),f=r(53240),m=r(59324),d=function(e){var t=e.chat,r=e.onSubmit,a=e.onChangeChat,l=e.placeholder,i=(0,o.g)(),d=(0,n.useRef)(null),p=(0,m.Ay)("/api/workspaces/".concat(i.workspace,"/members"),f.A),y=p.data,b=(p.error,p.mutate,(0,n.useCallback)((function(e,t,r,a,l){if(y)return n.createElement("button",{type:"button",className:"w-full flex ".concat(l?"bg-gray-400":"white")},n.createElement("img",{src:u().url(y[a].email,{s:"24px",d:"retro"}),alt:""}),n.createElement("span",null,r))}),[]));return(0,n.useEffect)((function(){d.current&&(0,c.A)(d.current)}),[]),n.createElement("div",{className:"px-[20px] pb-[20px]"},n.createElement(s.G,{rows:1,inputRef:d,value:t,onChange:a,onKeyDown:function(e){"Enter"===e.key&&!1===e.shiftKey&&t.trim()&&r(e)},placeholder:l,allowSuggestionsAboveCursor:!0,className:"resize-none [&_textarea]:!p-[10px] p-[10px] border-[1px] border-gray-300 border-solid w-full rounded-[8px]"},n.createElement(s.P,{appendSpaceOnAdd:!0,trigger:"@",data:(null==y?void 0:y.map((function(e){return{id:e.id,display:e.nickname}})))||[],renderSuggestion:b})))},p=r(35880);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var b=(0,n.forwardRef)((function(e,t){var r=e.chatData,a=(e.setScrollValues,e.setSize),l=(e.isEmpty,e.isReachingEnd),o=(0,n.useRef)(null),c=(0,n.useCallback)((function(e){0!==e.scrollTop||l||a((function(e){return e+1})).then((function(){var t=null==o?void 0:o.current;t&&t.scrollTop(t.getScrollHeight()-e.scrollHeight)})),console.log(e)}),[o,l,a]);return n.createElement(p.ur,{ref:t,onScrollFrame:c,autoHide:!0},n.createElement("div",{className:"flex flex-col flex-1 py-[16px] px-[20px]"},Object.entries(r).map((function(e){var t,r,a=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l,o,c=[],i=!0,u=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=l.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],o=a[1];return n.createElement("div",{key:l},n.createElement("div",{className:"center sticky top-[6px]"},n.createElement("p",{className:"px-[10px] py-[4px] border-[#eee] border-[1px] rounded-full text-[#777] text-[12px]"},l)),o.map((function(e,t){return n.createElement(x,{key:e.id,chat:e})})))}))))})),v=r(74353),h=r.n(v),x=function(e){var t=e.chat,r="Sender"in t?t.Sender:t.User;return n.createElement("div",{className:"flex items-start"},n.createElement("button",{type:"button",className:"mt-[4px] flex items-center justify-center rounded-[4px] overflow-hidden"},n.createElement("img",{src:u().url(r.email,{s:"24px",d:"retro"}),alt:""})),n.createElement("div",{className:"ml-[6px]"},n.createElement("div",{className:"flex items-center mb-[4px]"},n.createElement("p",{className:"text-[16px] text-black font-[600] mr-[4px]"},r.nickname),n.createElement("p",{className:"text-[12px] text-gray-500 font-[400]"},h()(t.createdAt).format("h:mm A"))),n.createElement("p",null,t.content)))}},15094:(e,t,r)=>{r.d(t,{G:()=>l});var n=r(96540);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var l=function(e){var t,r,l=(t=(0,n.useState)(e),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l,o,c=[],i=!0,u=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=l.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=l[0],c=l[1],i=(0,n.useCallback)((function(e){c(e.target.value)}),[o]);return[o,c,i]}},37916:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(37115),a=r(96540),l={};const o=function(e){var t=(0,a.useCallback)((function(){e&&(l[e].disconnect(),delete l[e])}),[e]);return e?(l[e]||(l[e]=n.Ay.connect("".concat("http://localhost:3095","/ws-").concat(e),{transports:["websocket"]})),[l[e],t]):[void 0,t]}},56746:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var n=r(96540),a=r(47767),l=r(59324),o=r(23041),c=r(53240),i=r(93365),u=r.n(i),s=r(15094),f=r(16048),m=r(72505),d=r.n(m),p=r(37916),y=r(25974);function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l,o,c=[],i=!0,u=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=l.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"==typeof e)return h(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}const x=function(){var e,t,r=(0,a.g)(),i=r.workspace,m=r.id,x=b((0,p.A)(i),1)[0],g=(0,n.useRef)(null),A=b((0,n.useState)(),2),E=(A[0],A[1]),S=(0,l.Ay)("/api/workspaces/".concat(i,"/users/").concat(m),c.A),w=S.data,k=(S.error,S.mutate,(0,l.Ay)("/api/users",c.A).data),C=(0,o.Ay)((function(e){return"/api/workspaces/".concat(i,"/dms/").concat(m,"/chats?perPage=20&page=").concat(e+1)}),c.A),N=C.data,j=(C.error,C.mutate),I=C.setSize,Y=0===(null==N||null===(e=N[0])||void 0===e?void 0:e.length),O=Y||N&&(null===(t=N[N.length-1])||void 0===t?void 0:t.length)<20||!1,T=b((0,s.G)(""),3),D=T[0],M=T[1],R=T[2],_=(0,n.useCallback)((function(){if(console.log("메세지 전송"),null!=D&&D.trim()&&N){var e=D;j((function(t){var r;return null==t||t[0].unshift({id:((null===(r=N[0][0])||void 0===r?void 0:r.id)||0)+1,content:e,SenderId:k.id,Sender:k,ReceiverId:w.id,Receiver:w,createdAt:new Date}),t}),!1).then((function(){M(""),setTimeout((function(){var e;console.log("스크롤 이동2222"),null===(e=g.current)||void 0===e||e.scrollToBottom()}),100)})),d().post("/api/workspaces/".concat(i,"/dms/").concat(m,"/chats"),{content:D},{withCredentials:!0}).then((function(){var e;M(""),j(),null===(e=g.current)||void 0===e||e.scrollToBottom()})).catch((function(e){console.log(e)}))}}),[D]);(0,n.useEffect)((function(){return null==x||x.on("dm",(function(e){console.log("메세지 수신"),j()})),function(){null==x||x.off("dm")}}),[]),(0,n.useEffect)((function(){1===(null==N?void 0:N.length)&&setTimeout((function(){var e;console.log("스크롤 이동111"),null===(e=g.current)||void 0===e||e.scrollToBottom()}),100)}),[N]),console.log(N);var B,z=(0,y.A)(N?(B=N,function(e){if(Array.isArray(e))return h(e)}(B)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(B)||v(B)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).flat().reverse():[]);return n.createElement(n.Fragment,null,n.createElement("div",{className:"flex items-center py-[16px] px-[20px] border-b border-b-[#eee]"},n.createElement("h3",{className:"flex items-center text-[18px] font-bold text-black"},n.createElement("button",{type:"button",className:"mt-[4px] flex items-center justify-center rounded-[4px] overflow-hidden"},n.createElement("img",{src:u().url(null==w?void 0:w.email,{s:"24px",d:"retro"}),alt:""})),n.createElement("span",{className:"ml-[10px]"},null==w?void 0:w.email))),n.createElement(f.b0,{chatData:z,ref:g,setScrollValues:E,setSize:I,isEmpty:Y,isReachingEnd:O}),n.createElement(f.sB,{chat:D,onChangeChat:R,onSubmit:_}))}},53240:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(72505),a=r.n(n);const l=function(e){return a().get(e,{withCredentials:!0}).then((function(e){return e.data}))}},25974:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(74353),a=r.n(n);const l=function(e){return e.reduce((function(e,t){return e[a()(t.createdAt).format("YYYY-MM-DD")]?e[a()(t.createdAt).format("YYYY-MM-DD")].push(t):e[a()(t.createdAt).format("YYYY-MM-DD")]=[t],e}),{})}}}]);
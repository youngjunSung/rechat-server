"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[829],{16048:(e,t,n)=>{n.d(t,{$n:()=>a,ry:()=>x,sB:()=>d,b0:()=>y,A_:()=>l});var r=n(96540),a=function(e){var t=e.className,n=e.text,a=e.onClick;return r.createElement("button",{type:"button",onClick:a,className:"flex items-center justify-center min-h-[54px] px-[10px] w-full bg-primary text-white rounded-[8px] text-[16px] font-bold ".concat(t)},n)},l=(0,r.memo)((function(e){var t=e.id,n=e.label,a=e.type,l=void 0===a?"text":a,o=e.className,c=e.onChange,i=e.value;return r.createElement("div",{className:"flex flex-col [&:not(&:last-child)]:mb-[20px] ".concat(o)},r.createElement("label",{htmlFor:t,className:"mb-[4px] text-primary text-[14px] font-[500]"},n),r.createElement("input",{type:l,id:t,className:"py-[10px] border-b-[2px] border-primary border-solid rounded-none focus:outline-none",onChange:c,value:i}))})),o=n(47767),c=n(31173),i=n(93365),u=n.n(i),s=n(35972),f=n(53240),m=n(59324),d=function(e){var t=e.chat,n=e.onSubmit,a=e.onChangeChat,l=e.placeholder,i=(0,o.g)(),d=(0,r.useRef)(null),p=(0,m.Ay)("/api/workspaces/".concat(i.workspace,"/members"),f.A),h=p.data,y=(p.error,p.mutate,(0,r.useCallback)((function(e,t,n,a,l){if(h)return r.createElement("button",{type:"button",className:"w-full flex ".concat(l?"bg-gray-400":"white")},r.createElement("img",{src:u().url(h[a].email,{s:"24px",d:"retro"}),alt:""}),r.createElement("span",null,n))}),[]));return(0,r.useEffect)((function(){d.current&&(0,c.A)(d.current)}),[]),r.createElement("div",{className:"px-[20px] pb-[20px]"},r.createElement(s.G,{rows:1,inputRef:d,value:t,onChange:a,onKeyDown:function(e){"Enter"===e.key&&!1===e.shiftKey&&t.trim()&&n(e)},placeholder:l,allowSuggestionsAboveCursor:!0,className:"resize-none [&_textarea]:!p-[10px] p-[10px] border-[1px] border-gray-300 border-solid w-full rounded-[8px]"},r.createElement(s.P,{appendSpaceOnAdd:!0,trigger:"@",data:(null==h?void 0:h.map((function(e){return{id:e.id,display:e.nickname}})))||[],renderSuggestion:y})))},p=n(35880);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var y=(0,r.forwardRef)((function(e,t){var n=e.chatData,a=(e.setScrollValues,e.setSize),l=(e.isEmpty,e.isReachingEnd),o=(0,r.useRef)(null),c=(0,r.useCallback)((function(e){0!==e.scrollTop||l||a((function(e){return e+1})).then((function(){var t=null==o?void 0:o.current;t&&t.scrollTop(t.getScrollHeight()-e.scrollHeight)})),console.log(e)}),[o,l,a]);return r.createElement(p.ur,{ref:t,onScrollFrame:c,autoHide:!0},r.createElement("div",{className:"flex flex-col flex-1 py-[16px] px-[20px]"},Object.entries(n).map((function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,o,c=[],i=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=l.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],o=a[1];return r.createElement("div",{key:l},r.createElement("div",{className:"center sticky top-[6px]"},r.createElement("p",{className:"px-[10px] py-[4px] border-[#eee] border-[1px] rounded-full text-[#777] text-[12px]"},l)),o.map((function(e,t){return r.createElement(x,{key:e.id,chat:e})})))}))))})),b=n(74353),v=n.n(b),x=function(e){var t=e.chat,n="Sender"in t?t.Sender:t.User;return r.createElement("div",{className:"flex items-start"},r.createElement("button",{type:"button",className:"mt-[4px] flex items-center justify-center rounded-[4px] overflow-hidden"},r.createElement("img",{src:u().url(n.email,{s:"24px",d:"retro"}),alt:""})),r.createElement("div",{className:"ml-[6px]"},r.createElement("div",{className:"flex items-center mb-[4px]"},r.createElement("p",{className:"text-[16px] text-black font-[600] mr-[4px]"},n.nickname),r.createElement("p",{className:"text-[12px] text-gray-500 font-[400]"},v()(t.createdAt).format("h:mm A"))),r.createElement("p",null,t.content)))}},15094:(e,t,n)=>{n.d(t,{G:()=>l});var r=n(96540);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e){var t,n,l=(t=(0,r.useState)(e),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,o,c=[],i=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=l.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=l[0],c=l[1],i=(0,r.useCallback)((function(e){c(e.target.value)}),[o]);return[o,c,i]}},37916:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(37115),a=n(96540),l={};const o=function(e){var t=(0,a.useCallback)((function(){e&&(l[e].disconnect(),delete l[e])}),[e]);return e?(l[e]||(l[e]=r.Ay.connect("".concat("http://localhost:3095","/ws-").concat(e),{transports:["websocket"]})),[l[e],t]):[void 0,t]}},89829:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(96540),a=n(47767),l=n(37916),o=n(59324),c=n(23041),i=n(53240),u=n(15094),s=n(16048),f=n(72505),m=n.n(f),d=n(75003),p=n(74848);const h=(0,d.A)((0,p.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");var y=n(77698),b=n(89737),v=n(22477),x=n(58763),g=n(25974);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,o,c=[],i=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=l.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(e,t)||E(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){if(e){if("string"==typeof e)return w(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const S=function(){var e,t,n=(0,a.g)(),f=n.workspace,d=n.channel,p=(n.id,A((0,l.A)(f),1)[0]),S=(0,r.useRef)(null),k=A((0,r.useState)(),2),C=k[0],N=k[1],j=A((0,u.G)(""),3),I=j[0],Y=j[1],O=j[2],D=A((0,u.G)(""),3),M=D[0],T=D[1],R=D[2],_=A((0,r.useState)(!1),2),U=_[0],z=_[1],H=function(){z(!1)},$=(0,o.Ay)("/api/users",i.A).data,B=(0,o.Ay)("/api/workspaces/".concat(f,"/channels/").concat(d),i.A).data,G=((0,o.Ay)($?"/api/workspaces/".concat(f,"/channels/").concat(d,"/members"):null,i.A).data,(0,c.Ay)((function(e){return"/api/workspaces/".concat(f,"/channels/").concat(d,"/chats?perPage=20&page=").concat(e+1)}),i.A)),F=G.data,P=(G.error,G.mutate),V=G.setSize,K=0===(null==F||null===(e=F[0])||void 0===e?void 0:e.length),q=K||F&&(null===(t=F[F.length-1])||void 0===t?void 0:t.length)<20||!1,J=(0,r.useCallback)((function(){if(console.log("메세지 전송"),null!=I&&I.trim()&&$&&F&&B){var e=I;P((function(t){var n;return null==t||t[0].unshift({id:((null===(n=F[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,UserId:$.id,User:$,ChannelId:B.id,Channel:B,createdAt:new Date}),t}),!1).then((function(){Y(""),setTimeout((function(){var e;console.log("스크롤 이동2222"),null===(e=S.current)||void 0===e||e.scrollToBottom()}),100)})),m().post("/api/workspaces/".concat(f,"/channels/").concat(d,"/chats"),{content:I},{withCredentials:!0}).then((function(){Y(""),P()})).catch((function(e){console.log(e)}))}}),[I]);(0,r.useEffect)((function(){return null==p||p.on("message",(function(e){console.log("메세지 수신"),P()})),function(){null==p||p.off("message")}}),[]),(0,r.useEffect)((function(){1===(null==F?void 0:F.length)&&setTimeout((function(){var e;null===(e=S.current)||void 0===e||e.scrollToBottom()}),100)}),[F]),console.log(F);var L,Q=(0,g.A)(F?(L=F,function(e){if(Array.isArray(e))return w(e)}(L)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(L)||E(L)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).flat().reverse():[]);return console.dir(Q),console.log(C),r.createElement(r.Fragment,null,r.createElement("div",{className:"flex items-center py-[16px] px-[20px] border-b border-b-[#eee]"},r.createElement("h3",{className:"text-[18px] font-bold text-black"},d),r.createElement("button",{type:"button",onClick:function(){z(!0)},className:"ml-auto center"},r.createElement(h,null)),r.createElement(y.A,{open:U,onClose:H,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.createElement(b.A,{id:"alert-dialog-title"},r.createElement("span",{className:"text-[18px] text-primary font-bold"},"사용자 초대")),r.createElement(v.A,null,r.createElement(s.A_,{label:"이메일",type:"email",value:M,onChange:R})),r.createElement(x.A,null,r.createElement(s.$n,{text:"초대하기",onClick:function(){m().post("/api/workspaces/".concat(f,"/channels/").concat(d,"/members"),{email:M},{withCredentials:!0}).then((function(){T(""),H()})).catch((function(e){console.log(e)}))}})))),r.createElement("div",{className:"flex flex-col-reverse flex-1"},r.createElement(s.b0,{chatData:Q,ref:S,setScrollValues:N,setSize:V,isEmpty:K,isReachingEnd:q})),r.createElement(s.sB,{chat:I,onChangeChat:O,onSubmit:J}))}},53240:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(72505),a=n.n(r);const l=function(e){return a().get(e,{withCredentials:!0}).then((function(e){return e.data}))}},25974:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(74353),a=n.n(r);const l=function(e){return e.reduce((function(e,t){return e[a()(t.createdAt).format("YYYY-MM-DD")]?e[a()(t.createdAt).format("YYYY-MM-DD")].push(t):e[a()(t.createdAt).format("YYYY-MM-DD")]=[t],e}),{})}}}]);